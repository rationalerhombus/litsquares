<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Litsquares | Modern Book Grid</title>
    <style>
        :root {
            --bg: #fdf5e6;
            --text: #1a1a1a;
            --primary: #6b4e71; /* Sophisticated Millennial Purple */
            --correct: #8fbc8f;
            --wrong: #e9967a;
            --cell-bg: #ffffff;
            --border: #333;
        }

        [data-theme="dark"] {
            --bg: #1a1a1a;
            --text: #fdf5e6;
            --cell-bg: #2d2d2d;
            --border: #555;
        }

        * { box-sizing: border-box; transition: background 0.3s ease; }
        
        body { 
            background-color: var(--bg); 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", serif; 
            display: flex; flex-direction: column; align-items: center; 
            padding: 10px; color: var(--text); margin: 0; 
            min-height: 100vh;
        }

        h1 { font-size: clamp(1.5rem, 5vw, 2.2rem); margin: 10px 0; font-weight: 800; letter-spacing: -1px; }
        
        #status-bar { 
            margin-bottom: 15px; font-size: 1rem; font-weight: 600; 
            background: var(--cell-bg); padding: 8px 20px; border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* The Grid - Scalable and Square */
        .game-container { 
            display: grid; 
            grid-template-columns: 0.8fr 1fr 1fr 1fr; 
            grid-template-rows: 0.8fr 1fr 1fr 1fr; 
            gap: 6px; 
            width: 95vw; 
            max-width: 500px; 
            aspect-ratio: 1 / 1;
        }

        .cell { 
            display: flex; align-items: center; justify-content: center; 
            background-color: var(--cell-bg); border-radius: 8px;
            padding: 4px; text-align: center; position: relative; 
            border: 2px solid var(--border);
            font-size: clamp(0.7rem, 2vw, 0.9rem);
        }

        .header { 
            background-color: transparent; border: none;
            font-weight: 800; text-transform: uppercase; 
            color: var(--primary); font-size: clamp(0.6rem, 1.8vw, 0.75rem);
        }

        input { 
            width: 100%; height: 100%; border: none; outline: none; 
            text-align: center; font-family: inherit; font-size: inherit;
            background: transparent; color: var(--text);
        }

        /* Animations */
        .correct { background-color: var(--correct) !important; color: white; animation: pop 0.3s ease; }
        .wrong { animation: shake 0.4s ease; background-color: var(--wrong) !important; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes pop {
            0% { transform: scale(0.9); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Modern Suggestion UI */
        .suggestions { 
            position: absolute; top: 100%; left: 0; width: 140%; 
            background: var(--cell-bg); border: 2px solid var(--border);
            z-index: 1000; display: none; border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); 
            max-height: 200px; overflow-y: auto;
        }
        .suggestion-item { 
            padding: 10px; cursor: pointer; border-bottom: 1px solid #eee;
            font-size: 0.8rem; text-align: left; color: var(--text);
        }

        .controls { margin-top: 20px; display: flex; gap: 10px; }
        button { 
            padding: 10px 20px; border-radius: 8px; border: none; 
            background: var(--primary); color: white; font-weight: bold; cursor: pointer;
        }

        #share-btn { display: none; background: #333; }
    </style>
</head>
<body>

    <h1 onclick="toggleTheme()">Litsquares</h1>
    <div id="status-bar">Guesses: <span id="guess-count">9</span></div>

    <div class="game-container" id="grid"></div>

    <div class="controls">
        <button onclick="toggleTheme()">üåì Theme</button>
        <button id="share-btn" onclick="shareResult()">Share Grid ‚ÜóÔ∏è</button>
    </div>

    <script>
        // MILLENNIAL ERA AUTHORS & LOGIC
        const authors = [
            { name: "Emily Henry", can: ["booktok", "romance", "modern"] },
            { name: "Sarah J. Maas", can: ["booktok", "fantasy", "modern"] },
            { name: "Sally Rooney", can: ["angst", "award", "modern"] },
            { name: "Ottessa Moshfegh", can: ["angst", "modern"] },
            { name: "R.F. Kuang", can: ["fantasy", "award", "modern"] },
            { name: "Colleen Hoover", can: ["booktok", "romance", "modern"] },
            { name: "Ocean Vuong", can: ["award", "angst", "modern"] },
            { name: "Taylor Jenkins Reid", can: ["booktok", "modern"] },
            { name: "Madeline Miller", can: ["fantasy", "booktok", "modern"] }
        ];

        const columns = [
            { label: "BookTok Fave", id: "booktok" },
            { label: "Romance / Spice", id: "romance" },
            { label: "Fantasy / Romantasy", id: "fantasy" },
            { label: "Millennial Angst", id: "angst" },
            { label: "Award Winner", id: "award" }
        ];

        let guessesLeft = 9;
        let scoreGrid = [ [0,0,0], [0,0,0], [0,0,0] ]; // For sharing results

        function toggleTheme() {
            const body = document.body;
            body.dataset.theme = body.dataset.theme === "dark" ? "light" : "dark";
        }

        function getDailySeed() {
            return new Date().setHours(0,0,0,0);
        }

        function seededRandom(seed) {
            var x = Math.sin(seed) * 10000;
            return x - Math.floor(x);
        }

        function generateGrid() {
            let seed = getDailySeed();
            let selectedCols = [...columns].sort(() => seededRandom(seed) - 0.5).slice(0, 3);
            let selectedRows = [...authors].sort(() => seededRandom(seed + 1) - 0.5).slice(0, 3);
            return { selectedRows, selectedCols };
        }

        const { selectedRows, selectedCols } = generateGrid();
        const gridElement = document.getElementById('grid');

        // Build Grid
        let html = `<div class="cell header"></div>`;
        selectedCols.forEach(c => html += `<div class="cell header">${c.label}</div>`);
        selectedRows.forEach((r, rIdx) => {
            html += `<div class="cell header">${r.name}</div>`;
            selectedCols.forEach((c, cIdx) => {
                html += `<div class="cell" data-row="${r.name}" data-col="${c.id}" data-ridx="${rIdx}" data-cidx="${cIdx}">
                            <input type="text" class="book-input" placeholder="?" autocomplete="off">
                            <div class="suggestions"></div>
                         </div>`;
            });
        });
        gridElement.innerHTML = html;

        // Interaction Logic
        const inputs = document.querySelectorAll('.book-input');
        inputs.forEach(input => {
            input.addEventListener('input', debounce(async (e) => {
                const query = e.target.value;
                const suggestionBox = e.target.nextElementSibling;
                if (query.length < 3) { suggestionBox.style.display = 'none'; return; }
                
                const response = await fetch(`https://openlibrary.org/search.json?title=${query}&limit=5`);
                const data = await response.json();
                suggestionBox.innerHTML = '';
                
                data.docs.forEach(book => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.innerText = `${book.title} (${book.first_publish_year || '?'})`;
                    div.onclick = () => validateGuess(input, book);
                    suggestionBox.appendChild(div);
                });
                suggestionBox.style.display = 'block';
            }, 300));
        });

        function validateGuess(input, bookData) {
            if (guessesLeft <= 0) return;
            
            const cell = input.parentElement;
            const suggestionBox = cell.querySelector('.suggestions');
            suggestionBox.style.display = 'none';
            
            const targetRow = cell.dataset.row;
            const targetCol = cell.dataset.col;
            const rIdx = cell.dataset.ridx;
            const cIdx = cell.dataset.cidx;

            const authorMatch = (bookData.author_name || []).some(a => a.toLowerCase().includes(targetRow.toLowerCase()));
            
            // Logic: Is the author known for this category? 
            // In a real app, you'd verify if the SPECIFIC book matches, 
            // but for this grid logic, we verify the Author/Category relationship.
            const authorObj = authors.find(a => a.name === targetRow);
            const isCorrect = authorMatch && authorObj.can.includes(targetCol);

            guessesLeft--;
            document.getElementById('guess-count').innerText = guessesLeft;

            if (isCorrect) {
                input.value = bookData.title;
                cell.classList.add('correct');
                input.disabled = true;
                scoreGrid[rIdx][cIdx] = 1;
            } else {
                cell.classList.add('wrong');
                setTimeout(() => cell.classList.remove('wrong'), 500);
                input.value = "";
            }

            if (guessesLeft === 0) endGame();
        }

        function endGame() {
            document.querySelectorAll('input').forEach(i => i.disabled = true);
            document.getElementById('share-btn').style.display = 'block';
            alert("Game Over! How did you do?");
        }

        function shareResult() {
            let emojiGrid = "Litsquares Daily\n";
            scoreGrid.forEach(row => {
                row.forEach(cell => emojiGrid += cell === 1 ? "üü©" : "‚¨ú");
                emojiGrid += "\n";
            });
            navigator.clipboard.writeText(emojiGrid);
            alert("Results copied to clipboard! üìã");
        }

        function debounce(func, timeout = 300){
            let timer;
            return (...args) => {
                clearTimeout(timer);
                timer = setTimeout(() => { func.apply(this, args); }, timeout);
            };
        }
    </script>
</body>
</html>
